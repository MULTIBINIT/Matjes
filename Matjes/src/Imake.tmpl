#include "Imakefile"

/* rules to make the program */

.SUFFIXES: .F .f .f90 .F90

SRCS= MC_fft constant main rw_lattice rw_zdir vector inp_rw Relaxation field-eff setup_zdir \
	sampling rw_efield Energy SignatureFile relaxationtype topocharge rw_skyrmion setup_neigh \
	mpi_gatherorsend fft gauge_util Energy_density coordinatesv4 structure demag-matrix \
	CalculateAverages WriteSpinAndCorrFile CreateSpinFile total_Energy DeriveValue CreationDestructionSkyrmion \
	init_rand_seed spstm MCstep InitSpin rw_dyna av_dynamics spindynamics topoplot qorien demag-tensor\
        dispBZ randist setup-simu setup_DM topocharge_sd field_sd Correlation sym_utils parallel_tempering

CPP_OBJS=

#ifdef parallel
MPI  = interface-mpi.o MC_transfer.o reconstruct-matrix.o mpi_prop.o mpi_gatherorsend.o make_box.o randperm.o split_work.o write_EM.o
#else
MPI  =
#endif

OBJS = topohall.o topocharge_local.o topocharge_all.o calculate_Beff.o fit.o derived_types.o constant.o vector.o sym_utils.o Correlation.o main.o rw_lattice.o \
	 field-eff.o MC_fft.o sampling.o Energy.o SignatureFile.o relaxationtype.o topocharge.o rw_skyrmion.o create_lattice.o \
	 fft.o init_rand_seed.o gauge_util.o Energy_density.o coordinatesv4.o setup_neigh.o qorienplot.o \
	 CalculateAverages.o WriteSpinAndCorrFile.o CreationDestructionSkyrmion.o topocharge_sd.o SkX_utils.o \
	 CreateSpinFile.o spstm.o inp_rw.o rw_dyna.o av_dynamics.o randist.o spindynamics.o setup_DM.o mtprng.o \
	 MCstep.o InitSpin.o Table_dist.o total_Energy.o DeriveValue.o Relaxation.o topoplot.o dispBZ.o setup-simu.o field_sd.o \
	 arrange_neihg.o mapping.o indexation.o order_lattice.o user_def_struct.o qorien.o solver.o stdtypes.o \
	 error_correction_SD.o Efield_sd.o error.o setup_zdir.o structure.o rw_efield.o rw_zdir.o gneb.o minimize.o \
	 MonteCarlo.o check_restart.o store_relaxation.o gneb_utils.o initialize_temperature.o cal_local_energy.o welcome.o parallel_tempering.o paratemp.o

#ifndef brutdip 
DIP  = setup_dipole.o demag-tensor.o demag-matrix.o
#else
DIP =
#endif


spin : $(OBJS) $(MPI) $(DIP)
	$(LD) -o $@ $(LDFLAGS) $(FIRST) $(OBJS) $(DIP) $(MPI) $(LIBRARIES)

.f.o:
	$(FC) $(CPPS) -c $< $(FFLAGS) -o $@

.F.o:
	$(FC) -c $< $(FFLAGS) -o $@

.f77.o:
	$(FC) -c $< $(FFLAGS) -o $@

.f90.o:
	$(FC) $(CPPS) -c $< $(FFLAGS) -o $@

#ifdef gfortran
.F90.o:
	$(FC) $(CPPS) -c $< $(FFLAGS) -ffree-form $(INCLUDES) -o $@
#else
.F90.o:
	$(FC) $(CPPS) -c $< $(FFLAGS) $(INCLUDES) -o $@
#endif

.f.a:
	$(FC) -c $(FFLAGS) $<
	$(AR) $(ARFLAGS) $@ $*.o
	$(RM) $*.o

.F.a:
	$(FC) -c $(FFLAGS) $<
	$(AR) $(ARFLAGS) $@ $*.o
	$(RM) $*.o

.f77.a:
	$(FC) -c $(FFLAGS) $<
	$(AR) $(ARFLAGS) $@ $*.o
	$(RM) $*.o


clean:
	$(RM) $(FIRST) $(OBJS) $(MPI) $(DIP) *.mod core *.o

touchsrcs:
	touch $(SRCS)

tests:
	cd tests && $(make)

welcome.o:
CreateSpinFile.o: constant.o rw_lattice.o inp_rw.o
topocharge_local.o: vector.o create_lattice.o inp_rw.o rw_lattice.o
topohall.o: vector.o constant.o create_lattice.o rw_lattice.o
calculate_Beff.o: field-eff.o inp_rw.o create_lattice.o randist.o create_lattice.o mtprng.o
fit.o:
user_def_struct.o: vector.o inp_rw.o create_lattice.o
derived_types.o:
rw_zdir.o:
vector.o:
rw_efield.o: create_lattice.o vector.o
topoplot.o: rw_lattice.o inp_rw.o constant.o create_lattice.o
av_dynamics.o: rw_lattice.o create_lattice.o Energy.o vector.o
WriteSpinAndCorrFile.o: CreateSpinFile.o rw_lattice.o create_lattice.o constant.o
init_rand_seed.o: main.o
CreationDestructionSkyrmion.o: rw_skyrmion.o rw_lattice.o create_lattice.o
MakeLattice.o: main.o
relaxationtype.o: field-eff.o
fft.o: rw_lattice.o create_lattice.o vector.o constant.o
randist.o: rw_dyna.o mtprng.o
Energy_density.o: main.o Energy.o MakeLattice.o rw_lattice.o create_lattice.o inp_rw.o Table_dist.o
rw_dyna.o: main.o
DM_vector.o: main.o
topocharge_sd.o: vector.o rw_lattice.o create_lattice.o constant.o inp_rw.o create_lattice.o
coordinatesv4.o: rw_lattice.o create_lattice.o gauge_util.o
SignatureFile.o: create_lattice.o inp_rw.o rw_lattice.o rw_efield.o
sampling.o: vector.o
InitSpin.o: create_lattice.o derived_types.o rw_lattice.o order_lattice.o mtprng.o
createSpinFile.o: rw_lattice.o constant.o inp_rw.o
computeDM.o: main.o
field_sd.o: field-eff.o rw_lattice.o create_lattice.o
rw_skyrmion.o: main.o SkX_utils.o
rw_lattice.o: vector.o derived_types.o create_lattice.o
MC_fft.o: vector.o constant.o rw_lattice.o create_lattice.o
Table_dist.o: vector.o derived_types.o
setup_neigh.o: rw_lattice.o create_lattice.o vector.o
spstm.o: rw_lattice.o create_lattice.o vector.o
setup_DM.o: vector.o derived_types.o Table_dist.o
create_lattice.o: derived_types.o
error.o:
mapping.o: create_lattice.o inp_rw.o vector.o derived_types.o
indexation.o: derived_types.o vector.o
dispBZ.o: inp_rw.o constant.o rw_lattice.o vector.o create_lattice.o constant.o sym_utils.o
order_lattice.o: derived_types.o
pathImc.o:
qorienplot.o: rw_lattice.o inp_rw.o constant.o create_lattice.o
SkX_utils.o: rw_lattice.o vector.o
stdtypes.o:
mtprng.o: stdtypes.o
Efield_sd.o: rw_lattice.o create_lattice.o inp_rw.o Energy.o
minimize.o: calculate_Beff.o inp_rw.o WriteSpinAndCorrFile.o solver.o av_dynamics.o
DeriveValue.o: inp_rw.o total_energy.o
gneb.o: field-eff.o Energy.o minimize.o gneb_utils.o
minimize.o: calculate_Beff.o inp_rw.o WriteSpinAndCorrFile.o solver.o av_dynamics.o
DeriveValue.o: inp_rw.o total_energy.o
MonteCarlo.o: initialize_temperature.o inp_rw.o mtprng.o check_restart.o Correlation.o vector.o store_relaxation.o parallel_tempering.o check_restart.o
Relaxation.o: store_relaxation.o mtprng.o Correlation.o MCstep.o
check_restart.o: 
store_relaxation.o: constant.o Correlation.o
topocharge.o: vector.o topoplot.o inp_rw.o
parallel_tempering.o: paratemp.o MCstep.o check_restart.o store_relaxation.o initialize_temperature.o CreateSpinFile.o
paratemp.o: fit.o mtprng.o constant.o inp_rw.o
gneb_utils.o: WriteSpinAndCorrFile.o calculate_Beff.o av_dynamics.o
initialize_temperature.o:
cal_local_energy.o: Energy.o


#ifdef parallel
arrange_neihg.o: create_lattice.o inp_rw.o sym_utils.o constant.o mpi_prop.o
solver.o: constant.o make_box.o create_lattice.o vector.o mtprng.o randist.o rw_dyna.o
Relaxation.o: main.o  inp_rw.o create_lattice.o mtprng.o write_EM.o topocharge_all.o
write_EM.o: vector.o constant.o mpi_prop.o
reconstruct-matrix.o: mpi_prop.o
setup_zdir.o: rw_lattice.o create_lattice.o make_box.o
gather_Energy.o: main.o
mpi_gatherorsend.o: inp_rw.o constant.o rw_lattice.o vector.o interface-mpi.o
make_box.o: error.o
interface-mpi.o:
spindynamics.o: Efield_sd.o createSpinFile.o error_correction_SD.o mpi_prop.o reconstruct-matrix.o topocharge_sd.o create_lattice.o inp_rw.o field-eff.o rw_dyna.o vector.o av_dynamics.o randist.o make_box.o rw_lattice.o solver.o calculate_Beff.o  mtprng.o cal_local_energy.o
total_energy.o: vector.o inp_rw.o make_box.o mpi_prop.o 
qorien.o: vector.o inp_rw.o rw_lattice.o mpi_gatherorsend.o make_box.o
Energy.o: rw_efield.o vector.o rw_lattice.o create_lattice.o inp_rw.o mpi_gatherorsend.o
topocharge.o: rw_lattice.o create_lattice.o vector.o mpi_gatherorsend.o create_lattice.o inp_rw.o
CalculateAverages.o: vector.o rw_lattice.o inp_rw.o mpi_gatherorsend.o create_lattice.o topocharge_all.o
randperm.o:
main.o: welcome.o WriteSpinAndCorrFile.o topohall.o mpi_prop.o fft.o qorien.o topocharge.o vector.o Correlation.o constant.o MC_fft.o create_lattice.o inp_rw.o rw_lattice.o CalculateAverages.o randperm.o parallel_tempering.o mtprng.o
parallel_tempering.o: inp_rw.o mtprng.o fit.o constant.o 
Correlation.o: vector.o constant.o derived_types.o create_lattice.o make_box.o
split_work.o: mpi_prop.o create_lattice.o
mpi_prop.o: 
inp_rw.o: rw_zdir.o rw_lattice.o constant.o mpi_prop.o interface-mpi.o
sym_utils.o: vector.o make_box.o
error_correction_SD.o: create_lattice.o solver.o vector.o constant.o inp_rw.o make_box.o mpi_prop.o reconstruct-matrix.o
MC_transfer.o: mpi_prop.o
MCstep.o: cal_local_energy.o MC_transfer.o create_lattice.o inp_rw.o rw_lattice.o  Energy.o sampling.o relaxationtype.o mtprng.o
topocharge_all.o: rw_lattice.o topocharge_local.o make_box.o

#else
arrange_neihg.o: create_lattice.o inp_rw.o sym_utils.o constant.o
MCstep.o: cal_local_energy.o main.o create_lattice.o inp_rw.o rw_lattice.o  Energy.o sampling.o relaxationtype.o mtprng.o
solver.o: constant.o create_lattice.o vector.o mtprng.o randist.o rw_dyna.o
Relaxation1000.o: main.o  inp_rw.o create_lattice.o mtprng.o topocharge_all.o
setup_zdir.o: rw_lattice.o create_lattice.o
inp_rw.o: rw_zdir.o rw_lattice.o constant.o mpi_prop.o
spindynamics.o: Efield_sd.o createSpinFile.o error_correction_SD.o topocharge_sd.o rw_lattice.o create_lattice.o inp_rw.o field-eff.o rw_dyna.o vector.o av_dynamics.o randist.o solver.o calculate_Beff.o  mtprng.o cal_local_energy.o
total_energy.o: vector.o inp_rw.o
qorien.o: vector.o inp_rw.o rw_lattice.o
Energy.o: main.o rw_efield.o vector.o rw_lattice.o create_lattice.o inp_rw.o 
topocharge.o: rw_lattice.o create_lattice.o vector.o create_lattice.o inp_rw.o
CalculateAverages.o: vector.o rw_lattice.o create_lattice.o topocharge_all.o
main.o: welcome.o WriteSpinAndCorrFile.o topohall.o fft.o qorien.o topocharge.o vector.o Correlation.o constant.o MC_fft.o create_lattice.o inp_rw.o rw_lattice.o CalculateAverages.o mtprng.o check_restart.o 
Correlation.o: vector.o constant.o derived_types.o create_lattice.o
sym_utils.o: vector.o
error_correction_SD.o: create_lattice.o solver.o vector.o constant.o inp_rw.o
topocharge_all.o: rw_lattice.o topocharge_local.o 

#endif

#ifndef brutdip
demag-tensor.o: constant.o vector.o fft.o
field-eff.o: vector.o rw_efield.o inp_rw.o rw_lattice.o create_lattice.o sym_utils.o setup_dipole.o

#ifdef parallel
demag-matrix.o: demag-tensor.o create_lattice.o inp_rw.o mpi_gatherorsend.o
#else
demag-matrix.o: demag-tensor.o create_lattice.o
#endif

error_correction_SD.o: create_lattice.o solver.o vector.o constant.o inp_rw.o 
setup_dipole.o: demag-matrix.o
setup-simu.o: setup_dipole.o user_def_struct.o topocharge.o arrange_neihg.o indexation.o mapping.o \
derived_types.o create_lattice.o inp_rw.o rw_lattice.o setup_DM.o main.o setup_neigh.o sym_utils.o Table_dist.o mtprng.o split_work.o

#else
setup-simu.o: user_def_struct.o topocharge.o arrange_neihg.o indexation.o mapping.o \
derived_types.o create_lattice.o inp_rw.o rw_lattice.o setup_DM.o main.o setup_neigh.o sym_utils.o Table_dist.o mtprng.o split_work.o
field-eff.o: inp_rw.o sym_utils.o rw_efield.o
error_correction_SD.o: create_lattice.o solver.o vector.o constant.o inp_rw.o 
#endif
